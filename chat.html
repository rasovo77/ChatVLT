<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>ChatVLT</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            height: 100vh;
            background: radial-gradient(circle at top left, #1d4ed8, #020617 50%, #000000);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: #e5e7eb;
            overflow: hidden;
        }

        /* Плаващ бутон (балон) долу вдясно */
        .chat-toggle {
            position: fixed;
            right: 26px;
            bottom: 24px;
            min-width: 110px;
            padding: 10px 18px;
            border-radius: 999px;
            border: none;
            background: radial-gradient(circle at 30% 20%, #ffffff, #60a5fa 40%, #1d4ed8 80%);
            box-shadow:
                0 0 20px rgba(59,130,246,0.9),
                0 0 40px rgba(59,130,246,0.5);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.18s ease-out, box-shadow 0.18s ease-out, filter 0.18s;
            z-index: 50;
        }

        .chat-toggle span {
            font-size: 15px;
            font-weight: 800;
            color: #020617;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .chat-toggle:hover {
            transform: translateY(-2px) scale(1.03);
            filter: brightness(1.06);
            box-shadow:
                0 0 26px rgba(59,130,246,1),
                0 0 60px rgba(59,130,246,0.7);
        }

        .chat-toggle.active {
            box-shadow:
                0 0 26px rgba(22,163,74,1),
                0 0 60px rgba(22,163,74,0.8);
        }

        /* Чат контейнер (glassmorphism) */
        .chat-shell {
            position: fixed;
            right: 26px;
            bottom: 96px;
            width: 380px;
            height: 72vh;
            max-height: 600px;
            background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.88));
            border-radius: 22px;
            border: 1px solid rgba(148,163,184,0.3);
            box-shadow:
                0 18px 45px rgba(15,23,42,0.9),
                0 0 0 1px rgba(15,23,42,0.8);
            backdrop-filter: blur(16px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform-origin: bottom right;
            transform: scale(0.2);
            opacity: 0;
            pointer-events: none;
            transition: transform 0.25s cubic-bezier(0.18,0.89,0.32,1.28), opacity 0.22s ease-out;
            z-index: 40;
        }

        .chat-shell::before {
            content: "";
            position: absolute;
            inset: -1px;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(59,130,246,0.8), rgba(236,72,153,0.8));
            opacity: 0.12;
            z-index: -1;
        }

        .chat-shell.open {
            transform: scale(1);
            opacity: 1;
            pointer-events: auto;
        }

        /* Лъч при отваряне */
        .beam {
            position: fixed;
            width: 5px;
            height: 0;
            background: linear-gradient(to top, #22c55e, #38bdf8, transparent);
            box-shadow:
                0 0 22px rgba(56,189,248,0.9),
                0 0 40px rgba(34,197,94,0.7);
            border-radius: 999px;
            z-index: 30;
            transform-origin: bottom center;
            animation: beamUp 0.35s ease-out forwards;
        }

        @keyframes beamUp {
            0%   { height: 0; opacity: 1; transform: translateY(0); }
            80%  { height: 72vh; opacity: 1; transform: translateY(-10px); }
            100% { height: 72vh; opacity: 0; transform: translateY(-14px); }
        }

        /* Взрив (burst) */
        .burst {
            position: fixed;
            width: 24px;
            height: 24px;
            border-radius: 999px;
            background: radial-gradient(circle, rgba(255,255,255,0.95), rgba(59,130,246,0.9), rgba(236,72,153,0.0));
            box-shadow:
                0 0 30px rgba(59,130,246,1),
                0 0 60px rgba(236,72,153,0.9);
            z-index: 35;
            transform: scale(0);
            opacity: 0.9;
            animation: burstAnim 0.45s ease-out forwards;
        }

        @keyframes burstAnim {
            0%   { transform: scale(0); opacity: 0.9; }
            70%  { transform: scale(3.8); opacity: 1; }
            100% { transform: scale(4.2); opacity: 0; }
        }

        /* Header */
        .chat-header {
            padding: 10px 12px 8px;
            border-bottom: 1px solid rgba(55,65,81,0.9);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-avatar {
            width: 28px;
            height: 28px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 20%, #ffffff, #60a5fa 45%, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: #0b1120;
            font-size: 14px;
            box-shadow: 0 0 10px rgba(59,130,246,0.85);
        }

        .chat-title-block {
            display: flex;
            flex-direction: column;
        }

        .chat-title {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .chat-subtitle {
            font-size: 11px;
            color: #9ca3af;
        }

        .chat-controls {
            margin-left: auto;
            display: flex;
            gap: 6px;
        }

        .chat-controls button {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: none;
            background: rgba(31,41,55,0.9);
            color: #e5e7eb;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .chat-controls button:hover {
            background: rgba(55,65,81,0.95);
        }

        /* Messages area */
        #messages {
            flex: 1;
            padding: 14px 14px 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 6px;
            background:
                radial-gradient(circle at 10% 0%, rgba(37,99,235,0.18), transparent 55%),
                radial-gradient(circle at 90% 100%, rgba(236,72,153,0.18), transparent 55%);
        }

        .msg-row {
            display: flex;
        }

        .msg {
            padding: 9px 12px;
            margin: 2px 0;
            border-radius: 14px;
            max-width: 80%;
            font-size: 14px;
            line-height: 1.35;
        }

        .user {
            margin-left: auto;
            background: linear-gradient(135deg, #38bdf8, #2563eb);
            color: #eff6ff;
            border-bottom-right-radius: 4px;
        }

        .bot {
            margin-right: auto;
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(55,65,81,0.9);
            color: #e5e7eb;
            border-bottom-left-radius: 4px;
        }

        /* Typing indicator */
        .typing {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .dot {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: #9ca3af;
            animation: bounce 1s infinite alternate;
        }
        .dot:nth-child(2) { animation-delay: 0.15s; }
        .dot:nth-child(3) { animation-delay: 0.3s; }

        @keyframes bounce {
            from { transform: translateY(0); opacity: 0.5; }
            to   { transform: translateY(-4px); opacity: 1; }
        }

        /* Input area */
        .input-box {
            padding: 10px;
            border-top: 1px solid rgba(31,41,55,0.9);
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(to top, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
        }

        .input-box input {
            flex: 1;
            padding: 9px 11px;
            border-radius: 999px;
            border: 1px solid rgba(55,65,81,0.9);
            background: rgba(15,23,42,0.9);
            color: #e5e7eb;
            outline: none;
            font-size: 13px;
        }

        .input-box input::placeholder {
            color: #6b7280;
        }

        .input-box button {
            padding: 9px 16px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #ecfdf5;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(22,163,74,0.6);
            transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, filter 0.08s;
        }

        .input-box button:hover {
            transform: translateY(-1px);
            filter: brightness(1.05);
            box-shadow: 0 0 16px rgba(22,163,74,0.9);
        }

        .input-box button:active {
            transform: translateY(0);
            box-shadow: 0 0 6px rgba(22,163,74,0.5);
        }

    </style>
</head>
<body>

<!-- Плаващ бутон -->
<button class="chat-toggle" id="chatToggle">
    <span>ChatVLT</span>
</button>

<!-- Чат прозорец -->
<div class="chat-shell" id="chatShell">
    <div class="chat-header">
        <div class="chat-avatar">V</div>
        <div class="chat-title-block">
            <div class="chat-title">ChatVLT</div>
            <div class="chat-subtitle">AI асистент за твоя бизнес</div>
        </div>
        <div class="chat-controls">
            <button id="minBtn">_</button>
            <button id="closeBtn">×</button>
        </div>
    </div>

    <div id="messages"></div>

    <div class="input-box">
        <input id="input" type="text" placeholder="Пиши съобщение...">
        <button id="sendBtn">Изпрати</button>
    </div>
</div>

<script>
const API_URL = "https://chatvlt.onrender.com/chat";


let typingRow = null;
let chatOpened = false;
let greeted = false;

function addMessage(text, type) {
    const row = document.createElement("div");
    row.className = "msg-row";

    const bubble = document.createElement("div");
    bubble.className = "msg " + type;
    bubble.textContent = text;

    row.appendChild(bubble);
    document.getElementById("messages").appendChild(row);
    bubble.scrollIntoView({ behavior: "smooth" });
}

function showTyping() {
    if (typingRow) return;
    typingRow = document.createElement("div");
    typingRow.className = "msg-row";

    const bubble = document.createElement("div");
    bubble.className = "msg bot";

    const typing = document.createElement("div");
    typing.className = "typing";

    for (let i = 0; i < 3; i++) {
        const d = document.createElement("div");
        d.className = "dot";
        typing.appendChild(d);
    }

    bubble.appendChild(typing);
    typingRow.appendChild(bubble);
    document.getElementById("messages").appendChild(typingRow);
    bubble.scrollIntoView({ behavior: "smooth" });
}

function hideTyping() {
    if (typingRow) {
        typingRow.remove();
        typingRow = null;
    }
}

async function sendMessage() {
    const input = document.getElementById("input");
    const msg = input.value.trim();
    if (!msg) return;

    addMessage(msg, "user");
    input.value = "";

    showTyping();

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: msg })
        });

        const data = await response.json();
        hideTyping();
        addMessage(data.reply, "bot");
    } catch (err) {
        hideTyping();
        addMessage("⚠️ Грешка: не мога да се свържа с ChatVLT сървъра.", "bot");
    }
}

function spawnFirework() {
    const toggle = document.getElementById("chatToggle");
    const shell = document.getElementById("chatShell");
    const btnRect = toggle.getBoundingClientRect();
    const shellRect = shell.getBoundingClientRect();

    // Лъч
    const beam = document.createElement("div");
    beam.className = "beam";
    beam.style.left = (btnRect.left + btnRect.width / 2 - 2.5) + "px";
    beam.style.bottom = (window.innerHeight - btnRect.bottom + 4) + "px";
    document.body.appendChild(beam);

    // Взрив
    const burst = document.createElement("div");
    burst.className = "burst";
    burst.style.left = (shellRect.left + shellRect.width / 2 - 12) + "px";
    burst.style.top = (shellRect.top + 40) + "px";
    document.body.appendChild(burst);

    setTimeout(() => {
        beam.remove();
        burst.remove();
    }, 700);
}

function openChat() {
    const shell = document.getElementById("chatShell");
    const btn = document.getElementById("chatToggle");
    chatOpened = true;
    shell.classList.add("open");
    btn.classList.add("active");
    spawnFirework();

    if (!greeted) {
        greeted = true;
        setTimeout(() => {
            addMessage(
                "Здравей! Аз съм ChatVLT – интелигентен асистент, който може да помага на клиенти, да отговаря вместо теб и да работи 24/7. Попитай ме нещо или ми дай задача.",
                "bot"
            );
        }, 350);
    }
}

function closeChat() {
    const shell = document.getElementById("chatShell");
    const btn = document.getElementById("chatToggle");
    chatOpened = false;
    shell.classList.remove("open");
    btn.classList.remove("active");
}

function toggleChat() {
    if (chatOpened) {
        closeChat();
    } else {
        openChat();
    }
}

document.getElementById("chatToggle").onclick = toggleChat;
document.getElementById("sendBtn").onclick = sendMessage;
document.getElementById("input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
});

document.getElementById("closeBtn").onclick = () => {
    closeChat();
};

document.getElementById("minBtn").onclick = () => {
    closeChat(); // за момента минимизиране = затваряне на прозореца
};
</script>

</body>
</html>
